pipeline {
    agent {label 'mp-vm'}

    stages {
        stage('Download App Bundle') {
            steps {
                sh '''
eval "curl '${url}/iot_operations/api/v1/adp/apps/${appid}/details?version=${appVersion}' \
  -H 'authorization: Bearer ${token}' \
  -o appbundle.json"

cat appbundle.json

                '''
            }
        }
        stage('Push app bundle to git repo local branch') {
            steps {
                sh '''
rm -Rf ${project_name}
git clone --depth 1 --single-branch -b ${github_local_branch} ${github_repo}

cd ${project_name}
mkdir -p ./resource/appbundle/
cp ../appbundle.json ./resource/appbundle/
git add .
git commit -m "AppBundle update"
git push origin
                '''
            }
        }
    }
}
